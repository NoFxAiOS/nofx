name: Fix Hugging Face Config

on:
  workflow_dispatch:

jobs:
  fix-config:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          ref: dev

      - name: Create correct README.md configuration
        run: |
          echo "åˆ›å»ºæ­£ç¡®çš„ Hugging Face é…ç½®..."
          
          # åˆ›å»ºæ­£ç¡®çš„ README.md é…ç½®
          cat > README.md << 'EOF'
---
title: NOFX AI Trading
emoji: ðŸš€
colorFrom: blue
colorTo: purple
sdk: streamlit
sdk_version: "1.28.0"
app_file: app.py
pinned: false
---

# NOFX AI Trading Platform

A multi-exchange AI trading platform with multi-AI competition and real-time dashboard.

## Features
- Multi-exchange support (Binance/Hyperliquid/Aster)
- Multi-AI competition (deepseek/qwen/claude)  
- Self-evolution capabilities
- Real-time dashboard

## Deployment
This Space is automatically synced from the official repository.

## Official Repository
https://github.com/NoFxAiOS/nofx
EOF
          
          echo "âœ… æ­£ç¡®çš„ README.md é…ç½®å·²åˆ›å»º"

      - name: Verify YAML syntax
        run: |
          echo "éªŒè¯ YAML è¯­æ³•..."
          pip install pyyaml
          python -c "
          import yaml
          with open('README.md', 'r') as f:
              content = f.read()
          
          # æå– YAML front matter
          if content.startswith('---'):
              parts = content.split('---')
              if len(parts) >= 3:
                  yaml_content = parts[1]
                  try:
                      data = yaml.safe_load(yaml_content)
                      print('âœ… YAML é…ç½®è¯­æ³•æ­£ç¡®')
                      print('é…ç½®å†…å®¹:', data)
                  except Exception as e:
                      print(f'âŒ YAML è¯­æ³•é”™è¯¯: {e}')
                      exit(1)
          "
          
          echo "âœ… é…ç½®éªŒè¯å®Œæˆ"

      - name: Ensure app.py exists and is valid
        run: |
          echo "ç¡®ä¿ app.py å­˜åœ¨ä¸”æœ‰æ•ˆ..."
          [ -f "app.py" ] && echo "âœ… app.py å­˜åœ¨" || echo "âŒ app.py ä¸å­˜åœ¨ï¼Œåˆ›å»ºé»˜è®¤ç‰ˆæœ¬"
          
          # å¦‚æžœ app.py ä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬
          if [ ! -f "app.py" ]; then
            cat > app.py << 'EOF'
import streamlit as st

def main():
    st.set_page_config(page_title="NOFX AI Trading", layout="wide")
    st.title("ðŸš€ NOFX AI Trading Platform")
    st.write("Application is starting...")
    
    # æ·»åŠ ä¸€äº›ç®€å•çš„å†…å®¹é¿å…é€’å½’é”™è¯¯
    st.success("âœ… Application loaded successfully!")

if __name__ == "__main__":
    main()
EOF
            echo "âœ… å·²åˆ›å»ºé»˜è®¤ app.py"
          fi

      - name: Deploy fixed configuration
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          echo "éƒ¨ç½²ä¿®å¤åŽçš„é…ç½®..."
          pip install huggingface_hub
          python -c "
          from huggingface_hub import HfApi
          import os
          api = HfApi(token=os.environ['HF_TOKEN'])
          try:
              api.upload_folder(
                  folder_path='.',
                  repo_id='lcy1313/nofxbishenjiqir',
                  repo_type='space',
                  commit_message='Fix: Correct Hugging Face configuration'
              )
              print('âœ… é…ç½®ä¿®å¤å·²éƒ¨ç½²')
          except Exception as e:
              print(f'âŒ éƒ¨ç½²å¤±è´¥: {e}')
              exit(1)
          "

      - name: Wait for build and check status
        run: |
          echo "ç­‰å¾…æž„å»ºå®Œæˆ..."
          echo "è¯·ç­‰å¾…2-3åˆ†é’Ÿè®© Hugging Face å®Œæˆæž„å»º"
          echo "ç„¶åŽè®¿é—®: https://lcy1313-nofxbishenjiqir.hf.space"
          echo ""
          echo "å¦‚æžœä»æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ Hugging Face çš„æž„å»ºæ—¥å¿—"
