name: Deploy to Hugging Face

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Prepare deployment files
        run: |
          # åˆ›å»ºä¸´æ—¶éƒ¨ç½²ç›®å½•
          mkdir -p deploy_temp
          
          # å¤åˆ¶æ ¸å¿ƒéƒ¨ç½²æ–‡ä»¶
          cp app.py deploy_temp/
          cp requirements.txt deploy_temp/
          cp Dockerfile deploy_temp/
          cp README.md deploy_temp/
          cp supabase_config.py deploy_temp/
          
          # å¤åˆ¶ src ç›®å½•åŠå…¶å†…å®¹
          if [ -d "src" ]; then
            cp -r src deploy_temp/
          fi
          
          # å¤åˆ¶é…ç½®æ–‡ä»¶
          if [ -f "config.py" ]; then
            cp config.py deploy_temp/
          fi
          
          # æ˜¾ç¤ºéƒ¨ç½²æ–‡ä»¶åˆ—è¡¨
          echo "ğŸ“ éƒ¨ç½²æ–‡ä»¶åˆ—è¡¨:"
          find deploy_temp -type f -name "*.py" -o -name "*.txt" -o -name "*.md" -o -name "Dockerfile" | sort
          
          echo "âœ… éƒ¨ç½²æ–‡ä»¶å‡†å¤‡å®Œæˆ"

      - name: Deploy to Hugging Face
        uses: peaceiris/actions-gh-pages@v3
        with:
          personal_token: ${{ secrets.HF_TOKEN }}
          external_repository: lcy1313/nofxbishenjigir
          publish_branch: main
          keep_files: false
          publish_dir: ./deploy_temp
          commit_message: "ğŸš€ Deploy from GitHub Actions - $(date +'%Y-%m-%d %H:%M:%S')"
